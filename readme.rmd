---
title: "Mapping DC Crime with R and Leaflet"
author: "Neil Kutty"
date: "April 3, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Getting the data
For my first blog post in a *long* time, I thought I would write a how-to on creating a simple leaflet map in R with with open data from opendata.dc.gov

Finding open data that is updated, recent, and easily accessible on the web has become easier with the recent strides in making data more accessible to everyone (see: opportunity.census.gov) and developers in particular (see: catalog.data.gov).  

Wanting to keep this post lightweight, map-centric, and regionally relevant, I am using a local dataset for the last 30 days of crime in Washington, D.C.

The dataset is available in downloadable or GeoJSON format. I'm going with JSON so that the shiny app can be standalone without additional need for data management.  


```{r cars}
## Retrieve the data in JSON format from opendata.dc.gov using fromJson()
dccrimejsonlite <- fromJSON('http://opendata.dc.gov/datasets/dc3289eab3d2400ea49c154863312434_8.geojson')
## use cbind() to access the list elements and create dataframe
dc_crime_json <- cbind(dccrimejsonlite$features$properties,dccrimejsonlite$features$geometry)

## Get distinct Offenses for shiny input
offenses <- distinct(select(dc_crime_json,OFFENSE))
row.names(offenses) <- offenses$OFFENSE

## Seperate and clean lat/long columns
## --also separate REPORTDATETIME column
dc_crime_clean <- dc_crime_json %>% 
  separate(coordinates, into = c("X", "Y"), sep = ",")%>%
  separate(REPORTDATETIME, into = c("Date","Time"), sep="T")

## convert lat and long columns to numbers and remove non numeric characters
dc_crime_clean$X <- as.numeric(gsub("c\\(","",dc_crime_clean$X))
dc_crime_clean$Y <- as.numeric(gsub("\\)","",dc_crime_clean$Y))

#Create date column from datetime

dc_crime_clean$DateClean <- as.Date(dc_crime_clean$Date)

bydate <- group_by(dc_crime_clean,DateClean,OFFENSE,SHIFT)
crimedc_bydate <- summarise(bydate,
                            count=n())
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
